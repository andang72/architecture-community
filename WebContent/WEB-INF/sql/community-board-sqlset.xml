<?xml version="1.0" encoding="UTF-8"?>
<sqlset>
	<name>COMMUNITY_BOARD</name>
	<description>COMMUNITY BOARD 쿼리</description>	
	
 	<sql-query name="CREATE_BOARD" description="BOARD 생성"><![CDATA[
		INSERT INTO MUSI_BOARD (
		  BOARD_ID,
		  NAME,
		  DISPLAY_NAME,
		  DESCRIPTION,
		  CREATION_DATE,
		  MODIFIED_DATE
		) VALUES ( ?, ?, ?, ?, ?, ? )
    ]]></sql-query>	

	<sql-query name="SELECT_ALL_BOARD_IDS" description="모든 BOARD 아이디 조회"><![CDATA[
		SELECT BOARD_ID FROM MUSI_BOARD
    ]]></sql-query>	

	<sql-query name="SELECT_BOARD_BY_ID" description="BOARD 조회"><![CDATA[
		SELECT
		  BOARD_ID,
		  NAME,
		  DISPLAY_NAME,
		  DESCRIPTION,
		  CREATION_DATE,
		  MODIFIED_DATE
		FROM MUSI_BOARD WHERE BOARD_ID = ?
    ]]></sql-query>	

	<sql-query name="DELETE_BOARD" description="BOARD 삭제"><![CDATA[
		DELETE FROM MUSI_BOARD WHERE BOARD_ID = ?
    ]]></sql-query>		


 	<sql-query name="CREATE_FORUM_THREAD" description="FORUM THREAD 생성"><![CDATA[
		INSERT INTO MUSI_BOARD_THREAD (
		  THREAD_ID,
		  OBJECT_TYPE,
		  OBJECT_ID,
		  ROOT_MESSAGE_ID,
		  CREATION_DATE,
		  MODIFIED_DATE
		) VALUES ( ?, ?, ?, ?, ?, ? )
    ]]></sql-query>	

 	<sql-query name="SELECT_FORUM_THREAD_BY_ID" description="FORUM THREAD 로드"><![CDATA[
		SELECT 
		  THREAD_ID,
		  OBJECT_TYPE,
		  OBJECT_ID,
		  ROOT_MESSAGE_ID,
		  CREATION_DATE,
		  MODIFIED_DATE
		FROM MUSI_BOARD_THREAD
		WHERE THREAD_ID = ?
    ]]></sql-query>	
    
    <sql-query name="UPDATE_FORUM_THREAD" description="FORUM THREAD UPDATE"><![CDATA[
		UPDATE MUSI_BOARD_THREAD
		SET ROOT_MESSAGE_ID = ?,  MODIFIED_DATE = ?
		WHERE THREAD_ID = ?
    ]]></sql-query>	

 	<sql-query name="SELECT_FORUM_THREAD_IDS_BY_OBJECT_TYPE_AND_OBJECT_ID" description="FORUM THREAD ID 로드"><![CDATA[
		SELECT 
		  THREAD_ID
		FROM MUSI_BOARD_THREAD
		WHERE OBJECT_TYPE = ? AND OBJECT_ID = ?
    ]]></sql-query>	
        
 	<sql-query name="SELECT_ALL_FORUM_MESSAGE_IDS_BY_THREAD_ID" description="FORUM THREAD MESSAGE ID 로드"><![CDATA[
		SELECT MESSAGE_ID FROM MUSI_BOARD_MESSAGE 
		WHERE THREAD_ID = ?
    ]]></sql-query>	        
        
    <sql-query name="SELECT_FORUM_THREAD_COUNT_BY_OBJECT_TYPE_AND_OBJECT_ID" description="FORUM THREAD COUNT"><![CDATA[
		SELECT COUNT( THREAD_ID ) FROM MUSI_BOARD_THREAD 
		WHERE OBJECT_TYPE = ? AND OBJECT_ID = ?
    ]]></sql-query>	        
        
        
    <sql-query name="UPDATE_FORUM_THREAD_MODIFIED_DATE"  description="FORUM THREAD MODIFIED_DATE UPDATE"><![CDATA[
		UPDATE MUSI_BOARD_MESSAGE SET MODIFIED_DATE = ? WHERE THREAD_ID = ?
    ]]></sql-query>	  
    
	<sql-query name="CREATE_FORUM_MESSAGE" description="FORUM MESSAGE 생성"><![CDATA[
		INSERT INTO MUSI_BOARD_MESSAGE (
		  MESSAGE_ID,
		  PARENT_MESSAGE_ID,
		  THREAD_ID,
		  OBJECT_TYPE,
		  OBJECT_ID,
		  USER_ID,
		  SUBJECT,
		  BODY,
		  CREATION_DATE,
		  MODIFIED_DATE
		) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
    ]]></sql-query>	
  
  	<sql-query name="SELECT_FORUM_MESSAGE_BY_ID" description="FORUM MESSAGE 로드"><![CDATA[
		SELECT 
		  MESSAGE_ID,
		  PARENT_MESSAGE_ID,
		  THREAD_ID,
		  OBJECT_TYPE,
		  OBJECT_ID,
		  USER_ID,
		  SUBJECT,
		  BODY,
		  CREATION_DATE,
		  MODIFIED_DATE
		FROM MUSI_BOARD_MESSAGE
		WHERE MESSAGE_ID = ?
    ]]></sql-query>	
    
	<sql-query name="UPDATE_FORUM_MESSAGE" description="FORUM MESSAGE 업데이트"><![CDATA[    
	    	UPDATE MUSI_BOARD_MESSAGE SET 
			  SUBJECT = ?,
			  BODY = ?,
			  MODIFIED_DATE = ?		 
			WHERE MESSAGE_ID = ?
 	]]></sql-query> 
	
	<sql-query name="SELECT_LATEST_FORUM_MESSAGE_ID_BY_THREAD_ID" description="FORUM LATEST MESSAGE ID"><![CDATA[   
	SELECT MAX(T1.MESSAGE_ID) FROM MUSI_BOARD_MESSAGE T1
	WHERE T1.THREAD_ID = ? AND T1.CREATION_DATE = (
	  SELECT MAX(T2.CREATION_DATE) FROM MUSI_BOARD_MESSAGE T2
	  WHERE T2.THREAD_ID = T1.THREAD_ID
	)	
	]]></sql-query>       	

	<sql-query name="SELECT_FORUM_THREAD_MESSAGE_IDS_BY_THREAD_ID" description="SELECT_FORUM_THREAD_MESSAGE_IDS_BY_THREAD_ID"><![CDATA[   
	SELECT MESSAGE_ID FROM MUSI_BOARD_MESSAGE WHERE THREAD_ID = ? ORDER BY MODIFIED_DATE DESC
	]]></sql-query>  
		
	<sql-query name="SELECT_FORUM_THREAD_MESSAGE_COUNT_BY_THREAD_ID" description="SELECT_FORUM_THREAD_MESSAGE_COUNT_BY_THREAD_ID"><![CDATA[   
	SELECT COUNT(MESSAGE_ID) FROM MUSI_BOARD_MESSAGE WHERE THREAD_ID = ?
	]]></sql-query>  	

	<sql-query name="SELECT_BOARD_MESSAGE_COUNT_BY_OBJECT_TYPE_AND_OBJECT_ID" description="SELECT_BOARD_MESSAGE_COUNT_BY_OBJECT_TYPE_AND_OBJECT_ID"><![CDATA[   
	SELECT COUNT(MESSAGE_ID) FROM MUSI_BOARD_MESSAGE WHERE OBJECT_TYPE = ? AND OBJECT_ID = ?
	]]></sql-query>  

	<sql-query name="SELECT_FORUM_THREAD_MESSAGES_BY_THREAD_ID" description="SELECT_FORUM_THREAD_MESSAGES_BY_THREAD_ID"><![CDATA[   
	SELECT MESSAGE_ID, PARENT_MESSAGE_ID FROM MUSI_BOARD_MESSAGE 
	WHERE THREAD_ID = ? 
	AND PARENT_MESSAGE_ID IS NOT NULL 
	AND PARENT_MESSAGE_ID > 0
	ORDER BY 
		CREATION_DATE, 
		MESSAGE_ID ASC			
	]]></sql-query>
		
</sqlset>